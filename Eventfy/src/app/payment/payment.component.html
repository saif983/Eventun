<app-navbar></app-navbar>

<div class="payment-container">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">
        <i class="fas fa-credit-card text-purple-600 mr-3"></i>
        Secure Payment
      </h1>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        Complete your ticket purchase with our secure payment system powered by Stripe.
      </p>
    </div>

    <!-- Payment Success State -->
    <div *ngIf="paymentSucceeded" class="success-container">
      <div class="bg-white rounded-lg shadow-lg p-8 text-center">
        <div class="success-icon">
          <i class="fas fa-check-circle text-6xl text-green-600 mb-4"></i>
        </div>
        <h2 class="text-3xl font-bold text-gray-900 mb-4">Payment Successful!</h2>
        <p class="text-lg text-gray-600 mb-6">
          Your payment has been processed successfully. You will receive a confirmation email shortly.
        </p>
        <div class="payment-details">
          <p class="text-sm text-gray-500 mb-2">Payment ID: {{ paymentIntent?.id }}</p>
          <p class="text-sm text-gray-500">Amount: ${{ getTotalAmount().toFixed(2) }}</p>
        </div>
        <div class="mt-8">
          <p class="text-gray-600">Redirecting to confirmation page...</p>
          <div class="loading-spinner mx-auto mt-4"></div>
        </div>
      </div>
    </div>

    <!-- Payment Form -->
    <div *ngIf="!paymentSucceeded" class="grid grid-cols-1 lg:grid-cols-2 gap-12">
      <!-- Order Summary -->
      <div class="order-summary">
        <div class="bg-white rounded-lg shadow-lg p-8">
          <h2 class="text-2xl font-semibold text-gray-900 mb-6">
            <i class="fas fa-receipt text-purple-600 mr-2"></i>
            Order Summary
          </h2>

          <!-- Ticket Items -->
          <div class="ticket-items">
            <div *ngFor="let item of ticketItems" class="ticket-item">
              <div class="item-details">
                <h3 class="item-name">{{ item.name }}</h3>
                <p class="item-description" *ngIf="item.description">{{ item.description }}</p>
                <div class="item-info" *ngIf="item.eventDate">
                  <p><i class="fas fa-calendar mr-2"></i>{{ item.eventDate }}</p>
                  <p><i class="fas fa-clock mr-2"></i>{{ item.eventTime }}</p>
                  <p><i class="fas fa-map-marker-alt mr-2"></i>{{ item.eventLocation }}</p>
                </div>
              </div>
              
              <div class="item-controls">
                <div class="quantity-controls">
                  <button 
                    type="button"
                    (click)="updateQuantity(item.id, -1)"
                    [disabled]="item.quantity <= 1"
                    class="quantity-btn">
                    <i class="fas fa-minus"></i>
                  </button>
                  <span class="quantity">{{ item.quantity }}</span>
                  <button 
                    type="button"
                    (click)="updateQuantity(item.id, 1)"
                    [disabled]="item.quantity >= 10"
                    class="quantity-btn">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
                <div class="item-price">
                  ${{ (item.price * item.quantity).toFixed(2) }}
                </div>
                <button 
                  type="button"
                  (click)="removeItem(item.id)"
                  class="remove-btn">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Order Totals -->
          <div class="order-totals">
            <div class="total-row">
              <span class="label">Items ({{ getTotalItems() }}):</span>
              <span class="value">${{ getTotalAmount().toFixed(2) }}</span>
            </div>
            <div class="total-row">
              <span class="label">Processing Fee:</span>
              <span class="value">$2.50</span>
            </div>
            <div class="total-row final-total">
              <span class="label">Total:</span>
              <span class="value">${{ (getTotalAmount() + 2.50).toFixed(2) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Form -->
      <div class="payment-form">
        <div class="bg-white rounded-lg shadow-lg p-8">
          <h2 class="text-2xl font-semibold text-gray-900 mb-6">
            <i class="fas fa-lock text-purple-600 mr-2"></i>
            Payment Information
          </h2>

          <form [formGroup]="paymentForm" (ngSubmit)="processPayment()" class="space-y-6">
            <!-- Customer Information -->
            <div class="customer-info">
              <h3 class="text-lg font-medium text-gray-900 mb-4">Contact Information</h3>
              
              <div class="form-group">
                <label for="email" class="form-label">Email Address *</label>
                <input 
                  type="email" 
                  id="email" 
                  formControlName="email"
                  class="form-input"
                  placeholder="your@email.com">
                <div *ngIf="paymentForm.get('email')?.invalid && paymentForm.get('email')?.touched" class="error-message">
                  Please enter a valid email address
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="fullName" class="form-label">Full Name *</label>
                  <input 
                    type="text" 
                    id="fullName" 
                    formControlName="fullName"
                    class="form-input"
                    placeholder="John Doe">
                  <div *ngIf="paymentForm.get('fullName')?.invalid && paymentForm.get('fullName')?.touched" class="error-message">
                    Full name is required
                  </div>
                </div>

                <div class="form-group">
                  <label for="phone" class="form-label">Phone Number *</label>
                  <input 
                    type="tel" 
                    id="phone" 
                    formControlName="phone"
                    class="form-input"
                    placeholder="+1 (555) 123-4567">
                  <div *ngIf="paymentForm.get('phone')?.invalid && paymentForm.get('phone')?.touched" class="error-message">
                    Please enter a valid phone number
                  </div>
                </div>
              </div>
            </div>

            <!-- Billing Address -->
            <div class="billing-address" formGroupName="billingAddress">
              <h3 class="text-lg font-medium text-gray-900 mb-4">Billing Address</h3>
              
              <div class="form-group">
                <label for="country" class="form-label">Country *</label>
                <select id="country" formControlName="country" class="form-input">
                  <option value="US">United States</option>
                  <option value="GB">United Kingdom</option>
                  <option value="CA">Canada</option>
                  <option value="FR">France</option>
                  <option value="DE">Germany</option>
                  <option value="ES">Spain</option>
                  <option value="IT">Italy</option>
                  <option value="MA">Morocco</option>
                </select>
                <div *ngIf="paymentForm.get('billingAddress.country')?.invalid && paymentForm.get('billingAddress.country')?.touched" class="error-message">
                  Country is required
                </div>
              </div>

              <div class="form-group">
                <label for="line1" class="form-label">Address Line 1 *</label>
                <input 
                  type="text" 
                  id="line1" 
                  formControlName="line1"
                  class="form-input"
                  placeholder="123 Main Street">
                <div *ngIf="paymentForm.get('billingAddress.line1')?.invalid && paymentForm.get('billingAddress.line1')?.touched" class="error-message">
                  Address is required
                </div>
              </div>

              <div class="form-group">
                <label for="line2" class="form-label">Address Line 2</label>
                <input 
                  type="text" 
                  id="line2" 
                  formControlName="line2"
                  class="form-input"
                  placeholder="Apartment, suite, etc. (optional)">
              </div>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="form-group">
                  <label for="city" class="form-label">City *</label>
                  <input 
                    type="text" 
                    id="city" 
                    formControlName="city"
                    class="form-input"
                    placeholder="New York">
                  <div *ngIf="paymentForm.get('billingAddress.city')?.invalid && paymentForm.get('billingAddress.city')?.touched" class="error-message">
                    City is required
                  </div>
                </div>

                <div class="form-group">
                  <label for="state" class="form-label">State *</label>
                  <input 
                    type="text" 
                    id="state" 
                    formControlName="state"
                    class="form-input"
                    placeholder="NY">
                  <div *ngIf="paymentForm.get('billingAddress.state')?.invalid && paymentForm.get('billingAddress.state')?.touched" class="error-message">
                    State is required
                  </div>
                </div>

                <div class="form-group">
                  <label for="postal_code" class="form-label">ZIP Code *</label>
                  <input 
                    type="text" 
                    id="postal_code" 
                    formControlName="postal_code"
                    class="form-input"
                    placeholder="10001">
                  <div *ngIf="paymentForm.get('billingAddress.postal_code')?.invalid && paymentForm.get('billingAddress.postal_code')?.touched" class="error-message">
                    ZIP code is required
                  </div>
                </div>
              </div>
            </div>

            <!-- Card Information -->
            <div class="card-info">
              <h3 class="text-lg font-medium text-gray-900 mb-4">Card Information</h3>
              
              <div class="form-group">
                <label class="form-label">Card Details *</label>
                <div id="card-element" class="card-element">
                  <!-- Stripe Elements will create form elements here -->
                </div>
                <div id="card-errors" class="card-errors" role="alert"></div>
              </div>
            </div>

            <!-- Security Notice -->
            <div class="security-notice">
              <div class="flex items-center p-4 bg-green-50 border border-green-200 rounded-lg">
                <i class="fas fa-shield-alt text-green-600 mr-3"></i>
                <div class="text-sm">
                  <p class="text-green-800 font-medium">Secure Payment</p>
                  <p class="text-green-700">Your payment information is encrypted and secure.</p>
                </div>
              </div>
            </div>

            <!-- Error Message -->
            <div *ngIf="paymentError" class="error-alert">
              <i class="fas fa-exclamation-triangle mr-2"></i>
              {{ paymentError }}
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button 
                type="button"
                (click)="goBack()"
                class="btn-secondary mr-4">
                <i class="fas fa-arrow-left mr-2"></i>
                Back to Cart
              </button>
              
              <button 
                type="submit"
                [disabled]="isProcessing || !paymentForm.valid"
                class="btn-primary">
                <span *ngIf="!isProcessing">
                  <i class="fas fa-credit-card mr-2"></i>
                  Pay ${{ (getTotalAmount() + 2.50).toFixed(2) }}
                </span>
                <span *ngIf="isProcessing" class="flex items-center">
                  <div class="loading-spinner-small mr-2"></div>
                  Processing...
                </span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Test Card Information -->
    <div class="test-info" *ngIf="!paymentSucceeded">
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mt-8">
        <h3 class="text-lg font-medium text-yellow-800 mb-3">
          <i class="fas fa-info-circle mr-2"></i>
          Test Mode - Use Test Cards
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-yellow-700">
          <div>
            <p class="font-medium mb-2">Successful Payment:</p>
            <p class="font-mono">4242 4242 4242 4242</p>
            <p class="text-xs">Any future date, any 3-digit CVC</p>
          </div>
          <div>
            <p class="font-medium mb-2">Declined Payment:</p>
            <p class="font-mono">4000 0000 0000 0002</p>
            <p class="text-xs">Any future date, any 3-digit CVC</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
